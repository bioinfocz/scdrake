<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>scdrake config internals • scdrake</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="scdrake config internals">
<meta property="og:description" content="How YAML config files are used in `scdrake`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=281550496"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '281550496');
</script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scdrake</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/scdrake.html">Get started</a>
</li>
<li>
  <a href="../articles/scdrake_integration.html">Integration pipeline guide</a>
</li>
<li>
  <a href="../articles/pipeline_overview.html">Pipeline overview</a>
</li>
<li>
  <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/scdrake_integration.html">02 Integration pipeline guide</a>
    </li>
    <li>
      <a href="../articles/scdrake_extend.html">Extending the pipeline</a>
    </li>
    <li>
      <a href="../articles/drake_basics.html">drake basics</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General information</li>
    <li>
      <a href="../articles/pipeline_overview.html">Pipeline overview</a>
    </li>
    <li>
      <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
    </li>
    <li>
      <a href="../articles/cluster_markers.html">Cluster markers</a>
    </li>
    <li>
      <a href="../articles/scdrake_config.html">scdrake config internals</a>
    </li>
    <li>
      <a href="../articles/scdrake_envvars.html">Environment variables</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General configs</li>
    <li>
      <a href="../articles/config_pipeline.html">Pipeline config</a>
    </li>
    <li>
      <a href="../articles/config_main.html">Main config</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Single-sample pipeline stages</li>
    <li>
      <a href="../articles/stage_input_qc.html">Input and quality control stage (`01_input_qc`)</a>
    </li>
    <li>
      <a href="../articles/stage_norm_clustering.html">Normalization and clustering stage (`02_norm_clustering`)</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Integration pipeline stages</li>
    <li>
      <a href="../articles/stage_integration.html">Integration stage (`01_integration`)</a>
    </li>
    <li>
      <a href="../articles/stage_int_clustering.html">Post-integration clustering stage (`02_int_clustering`)</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Common stages</li>
    <li>
      <a href="../articles/stage_cluster_markers.html">Cluster markers stage (`cluster_markers`)</a>
    </li>
    <li>
      <a href="../articles/stage_contrasts.html">Contrasts stage (`contrasts`)</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/bioinfocz/scdrake" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>scdrake config internals</h1>
            
            <h4 data-toc-skip class="date">2022-09-22</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioinfocz/scdrake/blob/mastervignettes/scdrake_config.Rmd" class="external-link"><code>vignettes/scdrake_config.Rmd</code></a></small>
      <div class="hidden name"><code>scdrake_config.Rmd</code></div>

    </div>

    
    
<hr>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> configs are stored in YAML files (in the
<code>config/</code> directory by default), which are parsed in R to
lists and used to build <a href="https://docs.ropensci.org/drake" class="external-link">drake</a> plans. YAML (<a href="https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html" class="external-link">quick
reference</a>, cheatsheets <a href="https://lzone.de/cheat-sheet/YAML" class="external-link">here</a> and <a href="https://learnxinyminutes.com/docs/yaml/" class="external-link">here</a>) is a
human-readable format and uses indentation (spaces) for nesting of
parameters.</p>
<p><a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> is using a concept of default and local
configs. Default configs are bundled with the package and copied during
project initialization, update, and pipeline run (e.g. in
<code><a href="../reference/run_pipeline.html">run_single_sample()</a></code> or in
<code>_drake_single_sample.R</code>). Local configs are, as their name
suggests, purposed to make modifications to default configs (see the
section below for how it is actually done). Default and local configs
are named <code>*.default.yaml</code> and <code>*.yaml</code>,
respectively.</p>
<p>Config files are separated according to general parameters and each
pipeline’s main stage (quality control, normalization, etc.), but for
consistency are always read all at once (by default if you run
e.g. <code><a href="../reference/run_pipeline.html">run_single_sample()</a></code> or
<code>drake::r_make("_drake_single_sample.R")</code>).</p>
<p>All paths in configs must be relative to project root, or absolute
(not recommended), unless otherwise stated.</p>
</div>
<div class="section level2">
<h2 id="updating-merging-configs">Updating (merging) configs<a class="anchor" aria-label="anchor" href="#updating-merging-configs"></a>
</h2>
<p>It may happen that new parameters are added to default configs. In
that case, those new parameters need to be appended to local configs,
while preserving the current local parameters. Calling this procedure
“update” is a little bit misleading, as we actually overwrite default
config by local one and append new parameters from default config to it.
“Merging” should be a better word, as we <em>merge</em> default config
with local one (and the order does matter).</p>
<p>Configs are merged recursively by parameter names. It is necessary to
realize that YAML format are nested dictionaries (or named lists in the
context of R). That is, this YAML</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Default config.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">BAR</span><span class="kw">:</span><span class="at"> </span><span class="st">"baz"</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_LIST</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">1</span><span class="kw">,</span><span class="at"> </span><span class="st">"hello"</span><span class="kw">]</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_NAMED_LIST</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">FOO_2</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">BAR_2</span><span class="kw">:</span><span class="at"> </span><span class="st">"zab"</span></span></code></pre></div>
<p>is in R parsed to the list:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>FOO <span class="op">=</span> <span class="fl">1L</span>, BAR <span class="op">=</span> <span class="st">"baz"</span>, FOO_LIST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="st">"hello"</span><span class="op">)</span>, FOO_NAMED_LIST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>FOO_2 <span class="op">=</span> <span class="fl">2L</span>, BAR_2 <span class="op">=</span> <span class="st">"zab"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>So, for example, given that the YAML above is our default config, we
want to merge it with the local config</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Local config.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">BAR</span><span class="kw">:</span><span class="at"> </span><span class="st">"zab"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_LIST</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">4</span><span class="kw">,</span><span class="at"> </span><span class="dv">5</span><span class="kw">,</span><span class="at"> </span><span class="dv">6</span><span class="kw">]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_NAMED_LIST</span><span class="kw">:</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">FOO_2</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">BAR_3</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div>
<p>resulting in</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Updated local config.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">BAR</span><span class="kw">:</span><span class="at"> </span><span class="st">"zab"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_LIST</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="dv">4</span><span class="kw">,</span><span class="at"> </span><span class="dv">5</span><span class="kw">,</span><span class="at"> </span><span class="dv">6</span><span class="kw">]</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_NAMED_LIST</span><span class="kw">:</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">FOO_2</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">BAR_2</span><span class="kw">:</span><span class="at"> </span><span class="st">"zab"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">BAR_3</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div>
<ul>
<li>
<code>FOO</code> is not updated.</li>
<li>
<code>BAR</code> and <code>FOO_LIST</code> are overwritten by the
local config.</li>
<li>
<code>FOO_NAMED_LIST</code>: <code>FOO_2</code> is updated,
<code>BAR_3</code> is added, but <code>BAR_2</code> is still present,
although it is not defined in the local config!</li>
</ul>
<div class="section level3">
<h3 id="merging-of-nested-named-lists">Merging of nested named lists<a class="anchor" aria-label="anchor" href="#merging-of-nested-named-lists"></a>
</h3>
<p>To overcome the problem with <code>FOO_NAMED_LIST</code>, parameters
with such structure are specified as a named list wrapped by an unnamed
list:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_NAMED_LIST</span><span class="kw">:</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">FOO_2</span><span class="kw">:</span><span class="at"> </span><span class="dv">2</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">BAR_2</span><span class="kw">:</span><span class="at"> </span><span class="st">"zab"</span></span></code></pre></div>
<p><strong>Note the beginning <code>-</code> creating the unnamed list
and indentation of values of the named list.</strong> This YAML is
parsed in R to</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>FOO_NAMED_LIST <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>FOO_2 <span class="op">=</span> <span class="fl">2L</span>, BAR_2 <span class="op">=</span> <span class="st">"zab"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If we modify the example of local config above to</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO_NAMED_LIST</span><span class="kw">:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">FOO_2</span><span class="kw">:</span><span class="at"> </span><span class="dv">3</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">BAR_3</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span></code></pre></div>
<p>then the whole <code>FOO_NAMED_LIST</code> parameter will be replaced
during a config merge, and that is the desired behaviour.</p>
</div>
<div class="section level3">
<h3 id="using-structure-of-a-default-config">Using structure of a default config<a class="anchor" aria-label="anchor" href="#using-structure-of-a-default-config"></a>
</h3>
<p>Also, by default, a structure (parameter positions, comments) of
local config is preserved during update. However, it is possible to use
the structure of a default config - see <code><a href="../reference/update_config.html">?update_config</a></code> for
more details.</p>
</div>
</div>
<div class="section level2">
<h2 id="using-r-code-in-parameters">Using R code in parameters<a class="anchor" aria-label="anchor" href="#using-r-code-in-parameters"></a>
</h2>
<p>A special type of parameter starting with <code>!code</code> can be
used to evaluate a value as R code:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EXAMPLE</span><span class="kw">:</span><span class="at"> !code 1:3</span></span></code></pre></div>
<p>First, non-code parameters are loaded to a separate environment and
then code parameters are evaluated in the context of this environment.
This means you can use other config parameters as R variables inside
code parameters:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FOO</span><span class="kw">:</span><span class="at"> </span><span class="dv">1</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">BAR</span><span class="kw">:</span><span class="at"> !code FOO + 1</span></span></code></pre></div>
<p>In addition, in stage configs (e.g. <code>02_norm_clustering</code>)
you can also use parameters (variables) from <code>pipeline.yaml</code>
and <code>00_main.yaml</code> configs:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">EXAMPLE</span><span class="kw">:</span><span class="at"> !code glue("{PROJECT_NAME}_{INSTITUTE}")</span></span></code></pre></div>
<p>See <code><a href="../reference/load_config.html">?load_config</a></code> for more details.</p>
</div>
<div class="section level2">
<h2 id="the-yq-tool">The <code>yq</code> tool<a class="anchor" aria-label="anchor" href="#the-yq-tool"></a>
</h2>
<p>Internally, the <a href="https://github.com/mikefarah/yq" class="external-link">yq</a> tool
(version 3) is used for merging of YAML files. It is a command line
utility whose binary needs to be downloaded. This is done automatically
during initialization of a new project, or you can do it manually
through <code><a href="../reference/download_yq.html">download_yq()</a></code>.</p>
<p>On <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> load or attach,
<code>SCDRAKE_YQ_BINARY</code> environment variable is read - if not
set, a value from <code>Sys.which("yq")</code> is used (this function
searches in <code>PATH</code> environment variable). Then
<code>scdrake_yq_binary</code> option is set, and is used as default
value to config-updating functions (see
<code><a href="../reference/update_config.html">?update_config</a></code>).</p>
<p>You can also look at <code><a href="../reference/check_yq.html">?check_yq</a></code> for details on how
<code>PATH</code> variable is treated in terminal vs. RStudio.</p>
</div>
<div class="section level2">
<h2 id="scdrake_list">
<code>scdrake_list</code><a class="anchor" aria-label="anchor" href="#scdrake_list"></a>
</h2>
<p>The base R’s extracting operators (<code>$</code>, <code>[</code>,
<code>[[</code>) are very benevolent for non-existing elements in
<code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> for which return <code>NULL</code>. This is not a
desired behaviour for config variables that must have a value or
explicit <code>NULL</code>. Returning <code>NULL</code> when the value
was actually not loaded from a config file can lead to unpredictable
results.</p>
<p>Thus, for storing config variables, <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> is using a
modified <code><a href="https://rdrr.io/r/base/list.html" class="external-link">list()</a></code> called <code><a href="../reference/scdrake_list.html">scdrake_list()</a></code> which is
using strict extracting operators. It behaves like a normal list:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span> <span class="op">&lt;-</span> <span class="fu">scdrake</span><span class="fu">::</span><span class="fu"><a href="../reference/scdrake_list.html">scdrake_list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>var_1 <span class="op">=</span> <span class="fl">1</span>, var_2 <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cfg</span><span class="op">$</span><span class="va">var_1</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 1</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[[</span><span class="st">"var_2"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 2</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[</span><span class="st">"var_1"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $var_1</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "scdrake_list" "list"</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"var_1"</span>, <span class="st">"var_2"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $var_1</span></span>
<span><span class="co">## [1] 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $var_2</span></span>
<span><span class="co">## [1] 2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "scdrake_list" "list"</span></span></code></pre>
<p>But extracting non-existing elements throws error:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">$</span><span class="va">var_3</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Variable <span style="color: #00BB00;">var_3</span> not found in `cfg`</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[[</span><span class="st">"var_3"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Variable <span style="color: #00BB00;">var_3</span> not found in `cfg`</span></span></code></pre>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[</span><span class="st">"var_3"</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error: Variable <span style="color: #00BB00;">var_3</span> not found in `cfg`</span></span></code></pre>
<p>For <code>[</code> and <code>[[</code>, this control can be turned
off by <code>check = FALSE</code> parameter:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[[</span><span class="st">"var_3"</span>, check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## NULL</span></span></code></pre>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cfg</span><span class="op">[</span><span class="st">"var_3"</span>, check <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## $var_3</span></span>
<span><span class="co">## NULL</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "scdrake_list" "list"</span></span></code></pre>
<p>Also, in this case <code>[</code> is more consistent: it returns a
valid named list, unlike the normal list, which sets
<code>NA_character_</code> as names of the non-existing elements.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jiri Novotny, Jan Kubovciak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '937cedcd467c204b19fc155c5f35019b',
    indexName: 'scdrake',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scdrake">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Using the Docker image • scdrake</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using the Docker image">
<meta property="og:description" content="scdrake">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=281550496"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '281550496');
</script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scdrake</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake_integration.html">Integration pipeline guide</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pipeline_overview.html">Pipeline overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../articles/scdrake_docker.html">Using the Docker image</a>
    <a class="dropdown-item" href="../articles/scdrake_integration.html">02 Integration pipeline guide</a>
    <a class="dropdown-item" href="../articles/scdrake_extend.html">Extending the pipeline</a>
    <a class="dropdown-item" href="../articles/drake_basics.html">drake basics</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>General information</h6>
    <a class="dropdown-item" href="../articles/pipeline_overview.html">Pipeline overview</a>
    <a class="dropdown-item" href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
    <a class="dropdown-item" href="../articles/scdrake_cli.html">Command line interface</a>
    <a class="dropdown-item" href="../articles/cluster_markers.html">Cluster markers</a>
    <a class="dropdown-item" href="../articles/scdrake_config.html">scdrake config internals</a>
    <a class="dropdown-item" href="../articles/scdrake_envvars.html">Environment variables</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>General configs</h6>
    <a class="dropdown-item" href="../articles/config_pipeline.html">Pipeline config</a>
    <a class="dropdown-item" href="../articles/config_main.html">Main config</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Single-sample pipeline stages</h6>
    <a class="dropdown-item" href="../articles/stage_input_qc.html">Input and quality control stage (`01_input_qc`)</a>
    <a class="dropdown-item" href="../articles/stage_norm_clustering.html">Normalization and clustering stage (`02_norm_clustering`)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Integration pipeline stages</h6>
    <a class="dropdown-item" href="../articles/stage_integration.html">Integration stage (`01_integration`)</a>
    <a class="dropdown-item" href="../articles/stage_int_clustering.html">Post-integration clustering stage (`02_int_clustering`)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Common stages</h6>
    <a class="dropdown-item" href="../articles/stage_cluster_markers.html">Cluster markers stage (`cluster_markers`)</a>
    <a class="dropdown-item" href="../articles/stage_contrasts.html">Contrasts stage (`contrasts`)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bioinfocz/scdrake" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        <li>
          <a class="external-link nav-link" id="css-toggle-btn" aria-label="github">
            <span class="fas fa fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Using the Docker image</h1>
            
            <h4 data-toc-skip class="date"><sup>Document generated:
2022-12-18 21:08:03 UTC+0000</sup></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioinfocz/scdrake/blob/mastervignettes/scdrake_docker.Rmd" class="external-link"><code>vignettes/scdrake_docker.Rmd</code></a></small>
      <div class="d-none name"><code>scdrake_docker.Rmd</code></div>
    </div>

    
    
<hr>
<p><a href="https://www.docker.com/" class="external-link">Docker</a> (<a href="https://en.wikipedia.org/wiki/Docker_(software)" class="external-link">wiki</a>) is a
software for running isolated <em>containers</em> which are based on
<em>images</em>. You can think of them as small, isolated operating
systems.</p>
<p>The <a href="https://bioconductor.org/help/docker/" class="external-link">Bioconductor’s
page for Docker</a> provides itself a nice introduction to Docker and
its usage for R, and we recommend to read it through. In this vignette,
we will mainly give practical examples related to
<a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a>.</p>
<hr>
<div class="section level2">
<h2 id="obtaining-the-docker-image">Obtaining the Docker image<a class="anchor" aria-label="anchor" href="#obtaining-the-docker-image"></a>
</h2>
<p>A Docker image based on the <a href="https://bioconductor.org/help/docker/" class="external-link">official Bioconductor
image</a> (version 3.15) is available. This is the most handy and
reproducible way how to use <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> as all the
dependencies are already installed and their version is fixed. In
addition, the parent Bioconductor image comes bundled with RStudio
Server.</p>
<p>You can pull the Docker image with the latest stable
<a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> version using</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull bioinfocz/scdrake:1.4.0-bioc3.15</span></code></pre></div>
<p>or list available versions in <a href="https://hub.docker.com/r/bioinfocz/scdrake/tags" class="external-link">our Docker Hub
repository</a>.</p>
<p>For the latest development version use</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> pull bioinfocz/scdrake:latest-bioc3.15</span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="running-the-image">Running the image<a class="anchor" aria-label="anchor" href="#running-the-image"></a>
</h2>
<p>The <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a>’s image is based on the <a href="https://bioconductor.org/help/docker/" class="external-link">Bioconductor’s image</a>
which is in turn based on the <a href="https://rocker-project.org/images/versioned/rstudio.html" class="external-link">Rocker
Project’s</a> image (<code>rocker/rstudio</code>). Thanks to it, the
<a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a>’s image comes bundled with RStudio Server.</p>
<p>Docker allows to mount local (host) directories to containers. We
recommend to create a local directory in which individual
<a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> projects (and other files, if needed) will lie.
This way you won’t lose data when a container is destroyed. Let’s create
such shared directory in your home directory and switch to it:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> ~/scdrake_projects</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> ~/scdrake_projects</span></code></pre></div>
<div class="section level3">
<h3 id="running-with-rstudio-server">Running with RStudio Server<a class="anchor" aria-label="anchor" href="#running-with-rstudio-server"></a>
</h3>
<p><a href="https://posit.co/products/open-source/rstudio-server/" class="external-link">RStudio
Server</a> is a comfortable IDE for R. You can run the image including
an RStudio instance using:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/home/rstudio/scdrake_projects <span class="dt">\</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-p</span> 8787:8787 <span class="dt">\</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> USERID=<span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> GROUPID=<span class="va">$(</span><span class="fu">id</span> <span class="at">-g</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> PASSWORD=1234 <span class="dt">\</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  scdrake:1.4.0-bioc3.15</span></code></pre></div>
<p>Let’s decompose the command above:</p>
<ul>
<li>
<code>docker run</code>: run image as a container.</li>
<li>
<code>-d</code>: run in detached (“background”) mode.</li>
<li>
<code>-v $(pwd):/home/rstudio/scdrake_projects</code>: mount the
current working directory on the host machine as
<code>/home/rstudio/scdrake_projects</code> inside the container.</li>
<li>
<code>-p 8787:8787</code>: expose port <code>8787</code> in
container as port <code>8787</code> on localhost.</li>
<li>
<code>-e USERID=$(id -u) -e GROUPID=$(id -g)</code>: change
ownership of <code>/home/rstudio</code> in the container to the ID and
group ID of the current host user. This is important as it sustains the
correct file ownership, i.e. when you write to
<code>/home/rstudio/scdrake_projects</code> from within the container,
you actually write to the host filesystem and you do so as the proper
user/group.</li>
<li>
<code>-e PASSWORD=1234</code>: password for RStudio Server (and the
username is <code>rstudio</code>).</li>
<li>
<code>scdrake:1.4.0-bioc3.15</code>: repository and tag of the image
to be run.</li>
</ul>
<p>The <code>-e VAR=VALUE</code> arguments are used to set environment
variables inside the container. You can check those for the parent
<code>rocker/rstudio</code> image <a href="https://rocker-project.org/images/versioned/rstudio.html#environment-variables" class="external-link">here</a>.</p>
<p>An image can have a default command which is executed on container
run. For our image, it’s a script <code>/init</code> which starts
RStudio Server.</p>
<p>Now you can check that the container is running:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> ps</span></code></pre></div>
<p>You should see something as</p>
<pre><code>CONTAINER ID   IMAGE                            COMMAND   CREATED        STATUS        PORTS                                       NAMES
d47b4d265052   scdrake:1.4.0-bioc3.15           "/init"   24 hours ago   Up 24 hours   0.0.0.0:8787-&gt;8787/tcp, :::8787-&gt;8787/tcp   condescending_payne</code></pre>
<p>Values in the <code>CONTAINER ID</code> and <code>NAMES</code>
columns can be then used to reference the running container.</p>
<p>You can see that we have exposed port <code>8787</code>. What it is
useful for? Well, it allows us to connect to RStudio Server, which is
running on port 8787 inside the container. Now you can just open your
browser, navigate to <code>localhost:8787</code> and login as
<code>rstudio</code> with password <code>1234</code>.</p>
<p>TIP: if you are using a remote server which you can SSH into and it
allows SSH tunneling, then you can forward the exposed port to your
host:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ssh</span> <span class="at">-NL</span> 8787:localhost:8787 user@server</span></code></pre></div>
<p>Now you can start using <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> from the RStudio, or
read below for alternative ways.</p>
</div>
<div class="section level3">
<h3 id="run-the-image-without-rstudio-server">Run the image without RStudio Server<a class="anchor" aria-label="anchor" href="#run-the-image-without-rstudio-server"></a>
</h3>
<p>If you just want to run the image detached without RStudio Server,
use</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> run <span class="at">-d</span> <span class="dt">\</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-u</span> rstudio <span class="dt">\</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">-v</span> <span class="va">$(</span><span class="bu">pwd</span><span class="va">)</span>:/home/rstudio/scdrake_projects <span class="dt">\</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  scdrake:1.4.0-bioc3.15 <span class="dt">\</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  sleep infinity</span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="issuing-commands-in-the-running-container">Issuing commands in the running container<a class="anchor" aria-label="anchor" href="#issuing-commands-in-the-running-container"></a>
</h2>
<p>You can start <code>bash</code> or <code>R</code> process inside the
container and attach to it using</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="at">-u</span> rstudio <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> bash</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="at">-u</span> rstudio <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> R</span></code></pre></div>
<ul>
<li>
<code>docker exec</code>: executes a command in a
<strong>running</strong> container.</li>
<li>
<code>-i</code>: interactive.</li>
<li>
<code>-d</code>: allocate a pseudo-TTY.</li>
</ul>
<hr>
</div>
<div class="section level2">
<h2 class="tabset" id="problems-with-filesystem-permissions">Problems with filesystem permissions<a class="anchor" aria-label="anchor" href="#problems-with-filesystem-permissions"></a>
</h2>
<p>In the first example, when we run the image including RStudio Server,
we specified <code>-e USERID=$(id -u) -e GROUPID=$(id -g)</code>, and so
ownership of <code>/home/rstudio</code> was changed to match the host
user*. Then when you write to the shared directory
<code>/home/rstudio/scdrake_projects</code>, you are basically doing
that as the host user.</p>
<p><em><sup>* This is actually not a feature of Docker, but the
<code>rocker/rstudio</code> image which uses those environment variables
to run the <code>/rocker_scripts/init_userconf.sh</code> which manages
the ownership.</sup></em></p>
<p>By default, <code>rstudio</code> user in the container has ID of 1000
which is commonly used for the default user in most Linux distributions.
You can check it yourself on your host by executing <code>id -u</code>.
If it is 1000, then you can safely skip the instructions below.</p>
<hr>
<p>So when you don’t want to run RStudio Server and your host user ID is
not 1000, you have to take care of ownership by yourself. There are
several ways how to accomplish that. You can also read about this
problem <a href="https://www.fullstaq.com/knowledge-hub/blogs/docker-and-the-host-filesystem-owner-matching-problem" class="external-link">here</a>
or <a href="https://vsupalov.com/docker-shared-permissions/" class="external-link">here</a>.</p>
<div class="section level3">
<h3 id="modify-the-user-and-group-id-in-the-container">Modify the user and group ID in the container<a class="anchor" aria-label="anchor" href="#modify-the-user-and-group-id-in-the-container"></a>
</h3>
<p>The <code>rocker/rstudio</code> parent image already comes with a
script which can add or modify user information (it is actually run when
you start the container including RStudio Server).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="dt">\</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">-e</span> USERID=<span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span> <span class="at">-e</span> GROUPID=<span class="va">$(</span><span class="fu">id</span> <span class="at">-g</span><span class="va">)</span> <span class="dt">\</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  bash /rocker_scripts/init_userconf.sh</span></code></pre></div>
<p>Note that this just changes ID and group of the <code>rstudio</code>
user, so later don’t forget to run commands as this user,
i.e. <code>docker exec -u rstudio ...</code></p>
</div>
<div class="section level3">
<h3 id="chowning-tedious">“Chowning” (tedious)<a class="anchor" aria-label="anchor" href="#chowning-tedious"></a>
</h3>
<p>If you have root privileges on the host, you can just change
ownership each time you write to the shared directory from the
container:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sudo</span> chown <span class="at">-R</span> <span class="va">$(</span><span class="fu">id</span> <span class="at">-u</span><span class="va">)</span>:<span class="va">$(</span><span class="fu">id</span> <span class="at">-g</span><span class="va">)</span> scdrake_projects</span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="issuing-scdrake-commands-through-its-command-line-interface-cli">Issuing <code>{scdrake}</code> commands through its command line
interface (CLI)<a class="anchor" aria-label="anchor" href="#issuing-scdrake-commands-through-its-command-line-interface-cli"></a>
</h2>
<p>We now assume that the <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> container is running
and the shared directory is mounted in
<code>/home/rstudio/scdrake_projects</code>. The <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a>
commands can be easily issued through its CLI (see
<code><a href="../articles/scdrake_cli.html">vignette("scdrake_cli")</a></code>):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="at">-u</span> rstudio <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  scdrake <span class="at">-h</span></span></code></pre></div>
<p>The usual workflow can be similar to the following:</p>
<ol style="list-style-type: decimal">
<li>Initialize a new project:</li>
</ol>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="at">-u</span> rstudio <span class="at">-w</span> /home/rstudio/scdrake_projects <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  scdrake <span class="at">-d</span> my_first_project init-project</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li><p>Modify the configs on your host in
<code>my_first_project/config/</code></p></li>
<li><p>Run the pipeline:</p></li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="ex">docker</span> exec <span class="at">-it</span> <span class="at">-u</span> rstudio <span class="at">-w</span> /home/rstudio/scdrake_projects/my_first_project <span class="op">&lt;</span>CONTAINER ID or NAME<span class="op">&gt;</span> <span class="dt">\</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  scdrake <span class="at">--pipeline-type</span> single_sample run</span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="create-a-command-alias">Create a command alias<a class="anchor" aria-label="anchor" href="#create-a-command-alias"></a>
</h2>
<p>To reduce typing/copy-pasting a bit, you can create a command alias
in your shell, here for <code>bash</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">alias</span> scdrake_docker=<span class="st">"docker exec -it -u rstudio &lt;CONTAINER ID or NAME&gt; scdrake"</span></span></code></pre></div>
<p>And then use this alias as e.g.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="ex">scdrake_docker</span> <span class="at">-d</span> /home/rstudio/scdrake_projects/my_first_project <span class="at">--pipeline-type</span> single_sample run</span></code></pre></div>
<p>Notice that we are using the <code>-d</code> parameter as the alias
doesn’t contain the <code>-w</code> parameter which instructs Docker to
execute the command in a working directory.</p>
<p>Finally, you can put the alias permanently inside your
<code>~/.bashrc</code> file. Just don’t forget to change
<code>&lt;CONTAINER ID or NAME&gt;</code> when you start a new container
:)</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by Jiri Novotny, Jan Kubovciak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

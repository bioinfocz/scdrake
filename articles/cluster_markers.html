<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Cluster markers â€¢ scdrake</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Cluster markers">
<meta property="og:description" content="How cluster markers are computed in `scdrake`">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=281550496"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '281550496');
</script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scdrake</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/scdrake.html">Get started</a>
</li>
<li>
  <a href="../articles/scdrake_integration.html">Integration pipeline guide</a>
</li>
<li>
  <a href="../articles/pipeline_overview.html">Pipeline overview</a>
</li>
<li>
  <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/scdrake_integration.html">02 Integration pipeline guide</a>
    </li>
    <li>
      <a href="../articles/scdrake_extend.html">Extending the pipeline</a>
    </li>
    <li>
      <a href="../articles/drake_basics.html">drake basics</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General information</li>
    <li>
      <a href="../articles/pipeline_overview.html">Pipeline overview</a>
    </li>
    <li>
      <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
    </li>
    <li>
      <a href="../articles/cluster_markers.html">Cluster markers</a>
    </li>
    <li>
      <a href="../articles/scdrake_config.html">scdrake config internals</a>
    </li>
    <li>
      <a href="../articles/scdrake_envvars.html">Environment variables</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General configs</li>
    <li>
      <a href="../articles/config_pipeline.html">Pipeline config</a>
    </li>
    <li>
      <a href="../articles/config_main.html">Main config</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Single-sample pipeline stages</li>
    <li>
      <a href="../articles/stage_input_qc.html">Input and quality control stage</a>
    </li>
    <li>
      <a href="../articles/stage_norm_clustering.html">Normalization and clustering stage</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Integration pipeline stages</li>
    <li>
      <a href="../articles/stage_integration.html">Integration stage</a>
    </li>
    <li>
      <a href="../articles/stage_int_clustering.html">Post-integration clustering stage</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Common stages</li>
    <li>
      <a href="../articles/stage_cluster_markers.html">Cluster markers stage</a>
    </li>
    <li>
      <a href="../articles/stage_contrasts.html">Contrasts stage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/bioinfocz/scdrake" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Cluster markers</h1>
            
            <h4 data-toc-skip class="date">2022-09-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioinfocz/scdrake/blob/mastervignettes/cluster_markers.Rmd" class="external-link"><code>vignettes/cluster_markers.Rmd</code></a></small>
      <div class="hidden name"><code>cluster_markers.Rmd</code></div>

    </div>

    
    
<hr>
<p>Taken from <a href="https://bioconductor.org/books/release/OSCA.basic/marker-detection.html" class="external-link">OSCA</a>,
slightly modified:</p>
<blockquote>
<p>To interpret our clustering results, we identify the genes that drive
separation between clusters. These marker genes allow us to assign
biological meaning to each cluster based on their functional annotation.
In the most obvious case, the marker genes for each cluster are a priori
associated with particular cell types, allowing us to treat the
clustering as a proxy for cell type identity. The same principle can be
applied to discover more subtle differences between clusters (e.g.,
changes in activation or differentiation state) based on the behavior of
genes in the affected pathways.</p>
</blockquote>
<blockquote>
<p>Identification of marker genes is usually based around the
retrospective detection of differential expression between clusters.
Genes that are more strongly DE are more likely to have caused separate
clustering of cells in the first place. Several different statistical
tests are available to quantify the differences in expression profiles,
and different approaches can be used to consolidate test results into a
single ranking of genes for each cluster. These choices parametrize the
theoretical differences between the various marker detection
strategies.</p>
</blockquote>
<div class="section level2">
<h2 id="used-statistical-tests">Used statistical tests<a class="anchor" aria-label="anchor" href="#used-statistical-tests"></a>
</h2>
<p>For each cell grouping and gene, three distinct, adjustable
statistical tests are computed through
<code><a href="https://rdrr.io/pkg/scran/man/findMarkers.html" class="external-link">scran::findMarkers()</a></code>:</p>
<ul>
<li>t-test (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseTTests.html" class="external-link">scran::pairwiseTTests()</a></code>): test for difference
in mean expression.</li>
<li>
<a href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test" class="external-link">Wilcoxon
signed-rank test</a> (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseWilcox.html" class="external-link">scran::pairwiseWilcox()</a></code>): test for
difference in median expression (roughly speaking).</li>
<li>Binomial test (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseBinom.html" class="external-link">scran::pairwiseBinom()</a></code>): test the null
hypothesis that the proportion of cells expressing a gene is the same
between groups.</li>
</ul>
<p>These tests are performed in a <a href="https://bioconductor.org/books/release/OSCA.basic/marker-detection.html#scoring-markers-by-pairwise-comparisons" class="external-link">pairwise
fashion</a> within each grouping, i.e.Â each level of the grouping is
tested against each other.</p>
<p>Example: three pairwise tests of each type are computed for k-means
clustering with <span class="math inline">\(k = 3\)</span>:</p>
<ul>
<li>Cluster 1 vs.Â Cluster 2</li>
<li>Cluster 1 vs.Â Cluster 3</li>
<li>Cluster 2 vs.Â Cluster 3</li>
</ul>
<p>The overall p-values, false discovery rate (FDR) and effect sizes
(log2 fold change (LFC) for t- and binomial test, and Area Under Curve
for Wilcoxon test) are calculated for the cell grouping from its all
pairwise tests (<code><a href="https://rdrr.io/pkg/scran/man/combineMarkers.html" class="external-link">scran::combineMarkers()</a></code>).</p>
</div>
<div class="section level2">
<h2 id="narrowing-down-the-number-of-cluster-markers">Narrowing down the number of cluster markers<a class="anchor" aria-label="anchor" href="#narrowing-down-the-number-of-cluster-markers"></a>
</h2>
<p>A more or less stringent approach can be used to narrow down the
number of cluster markers, based on results from individual pairwise
tests. This will also affect the combined p-value and FDR:</p>
<ul>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#looking-for-any-differences" class="external-link">Looking
for any differences</a>: for each level (cluster) of a grouping, take
top markers by p-value from each pairwise test. This will be shown as
<code>Top</code> column in marker table. Example: the set of all genes
with <code>Top</code> values of 1 contains the gene with the lowest
p-value from each comparison.</li>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#finding-cluster-specific-markers" class="external-link">Finding
cluster-specific markers</a>: a more stringent approach only considering
genes that are differentially expressed in all pairwise comparisons
involving the cluster of interest. For this purpose is used an
intersection-union test where the combined p-value for each gene is the
maximum of the p-values from all pairwise comparisons. A gene will only
achieve a low combined p-value if it is strongly DE in all comparisons
to other clusters.</li>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#balancing-stringency-and-generality" class="external-link">Balancing
stringency and generality</a>: the Holm-Bonferroni correction is applied
on pairwise p-values and the middle-most value is taken as the combined
p-value. This effectively tests the global null hypothesis that at least
50% of the individual pairwise comparisons exhibit no differential
expression.</li>
</ul>
<p>This can be controlled via the <code>PVAL_TYPE</code> parameter in
<code>cluster_markers.yaml</code> config. See
<code><a href="../articles/stage_cluster_markers.html">vignette("stage_cluster_markers")</a></code> for details.</p>
</div>
<div class="section level2">
<h2 id="handling-blocking-factors">Handling blocking factors<a class="anchor" aria-label="anchor" href="#handling-blocking-factors"></a>
</h2>
<p><a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#marker-batch" class="external-link">Blocking
factors</a> (e.g.Â batch effect, sex differences, cell cycle phases) can
be handled by further nesting. For that, each pairwise test is performed
separately in each level of the blocking factor. Then, p-values from
individual levelsâ€™ tests are combined, and the final combined p-values
are obtained by the method of choice (see above).</p>
<p>This can be controlled via the <code>BLOCK_COLUMN</code> parameter in
<code>cluster_markers.yaml</code> config. See
<code><a href="../articles/stage_cluster_markers.html">vignette("stage_cluster_markers")</a></code> for details.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jiri Novotny, Jan Kubovciak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '937cedcd467c204b19fc155c5f35019b',
    indexName: 'scdrake',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="scdrake">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/5/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>Cluster markers stage (`cluster_markers`) • scdrake</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Cluster markers stage (`cluster_markers`)">
<meta property="og:description" content="scdrake">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=281550496"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '281550496');
</script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/5/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/5/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">scdrake</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake_integration.html">Integration pipeline guide</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/pipeline_overview.html">Pipeline overview</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../articles/scdrake_docker.html">Using the Docker image</a>
    <a class="dropdown-item" href="../articles/scdrake_integration.html">02 Integration pipeline guide</a>
    <a class="dropdown-item" href="../articles/scdrake_advanced.html">Advanced topics</a>
    <a class="dropdown-item" href="../articles/scdrake_extend.html">Extending the pipeline</a>
    <a class="dropdown-item" href="../articles/drake_basics.html">drake basics</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>General information</h6>
    <a class="dropdown-item" href="../articles/pipeline_overview.html">Pipeline overview</a>
    <a class="dropdown-item" href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
    <a class="dropdown-item" href="../articles/scdrake_cli.html">Command line interface</a>
    <a class="dropdown-item" href="../articles/scdrake_config.html">scdrake config internals</a>
    <a class="dropdown-item" href="../articles/scdrake_envvars.html">Environment variables</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>General configs</h6>
    <a class="dropdown-item" href="../articles/config_pipeline.html">Pipeline config</a>
    <a class="dropdown-item" href="../articles/config_main.html">Main config</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Single-sample pipeline stages</h6>
    <a class="dropdown-item" href="../articles/stage_input_qc.html">Input and quality control stage (`01_input_qc`)</a>
    <a class="dropdown-item" href="../articles/stage_norm_clustering.html">Normalization and clustering stage (`02_norm_clustering`)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Integration pipeline stages</h6>
    <a class="dropdown-item" href="../articles/stage_integration.html">Integration stage (`01_integration`)</a>
    <a class="dropdown-item" href="../articles/stage_int_clustering.html">Post-integration clustering stage (`02_int_clustering`)</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Common stages</h6>
    <a class="dropdown-item" href="../articles/stage_cluster_markers.html">Cluster markers stage (`cluster_markers`)</a>
    <a class="dropdown-item" href="../articles/stage_contrasts.html">Contrasts stage (`contrasts`)</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bioinfocz/scdrake" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>

        
        <li>
          <a class="external-link nav-link" id="css-toggle-btn" aria-label="github">
            <span class="fas fa fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        
        
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Cluster markers stage (`cluster_markers`)</h1>
            
            <h4 data-toc-skip class="date"><sup>Document generated:
2023-12-19 08:41:33 UTC+0000</sup></h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioinfocz/scdrake/blob/mastervignettes/stage_cluster_markers.Rmd" class="external-link"><code>vignettes/stage_cluster_markers.Rmd</code></a></small>
      <div class="d-none name"><code>stage_cluster_markers.Rmd</code></div>
    </div>

    
    
<hr>
<div class="section level2 tabset">
<h2 class="tabset" id="section"></h2>



<ul class="nav nav-tabs" id="section" role="tablist">
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#overview" id="overview-tab" type="button" role="tab" aria-controls="overview" aria-selected="true" class="active nav-link">Overview</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#config-parameters" id="config-parameters-tab" type="button" role="tab" aria-controls="config-parameters" aria-selected="false" class="nav-link">Config parameters</button></li>
<li role="presentation" class="nav-item"><button data-bs-toggle="tab" data-bs-target="#outputs" id="outputs-tab" type="button" role="tab" aria-controls="outputs" aria-selected="false" class="nav-link">Outputs</button></li>
</ul>
<div class="tab-content">
<div class="active  tab-pane" id="overview" role="tabpanel" aria-labelledby="overview-tab">

<p>A stage for calculation, visualization and reporting of cell cluster
markers (“global markers”). This stage is common to both single-sample
and integration pipelines.</p>
<p>⚙️ Config files:
<code>config/single_sample/cluster_markers.yaml</code>,
<code>config/integration/cluster_markers.yaml</code></p>
<p>📋 HTML report target (in <code>config/pipeline.yaml</code>):
<code>DRAKE_TARGETS: ["report_cluster_markers"]</code></p>
<p><a href="https://onco.img.cas.cz/novotnyj/scdrake/single_sample/pbmc1k/cluster_markers/cluster_markers.html" class="external-link">📜
Example report for PBMC 1k data</a> (<a href="https://github.com/bioinfocz/scdrake/blob/main/tests/testthat/run_pipeline_config_patches/single_sample_pbmc1k_full/cluster_markers.default.yaml" class="external-link">used
config</a>)</p>
<p><a href="https://onco.img.cas.cz/novotnyj/scdrake/integration/cluster_markers/cluster_markers.html" class="external-link">📜
Example report for integrated data</a> (<a href="https://github.com/bioinfocz/scdrake/blob/main/tests/testthat/run_pipeline_config_patches/integration/cluster_markers.default.yaml" class="external-link">used
config</a>)</p>
<p>🪜 Structure</p>
<ul>
<li>
<a href="https://bioconductor.org/books/3.15/OSCA.basic/marker-detection.html" class="external-link">Calculation
of cluster markers</a>: any categorical grouping of cells can be used,
including those manually defined based on the existing groups from
clustering (but not only). See below for more details about marker
calculation.</li>
<li>Generation of heatmaps and plots. To reduce the size of heatmaps and
number of plots, you can control a number of top N markers taken by a
chosen metric (FDR, LFC, etc.). Only these top N markers will be
displayed in heatmaps, and plots made for them. This can be specified
for each cell grouping and test type.
<ul>
<li>Marker plots are composed of:
<ul>
<li>Two plots of a dimred: one colored by a clustering, and second
colored by expression of a marker (feature plot).</li>
<li>A plot of summarized marker expression: proportion of cells
expressing a marker, colored by average expression.</li>
<li>A violin plot: expression of a marker in each cluster.</li>
</ul>
</li>
</ul>
</li>
<li>Generation of marker tables for each cell grouping and each of its
levels.</li>
</ul>
<hr>
<div class="section level4">
<h4 id="marker-calculation-and-interpretation">Marker calculation and interpretation<a class="anchor" aria-label="anchor" href="#marker-calculation-and-interpretation"></a>
</h4>
<p>Taken from <a href="https://bioconductor.org/books/3.15/OSCA.basic/marker-detection.html" class="external-link">OSCA</a>,
slightly modified:</p>
<blockquote>
<p>To interpret our clustering results, we identify the genes that drive
separation between clusters. These marker genes allow us to assign
biological meaning to each cluster based on their functional annotation.
In the most obvious case, the marker genes for each cluster are a priori
associated with particular cell types, allowing us to treat the
clustering as a proxy for cell type identity. The same principle can be
applied to discover more subtle differences between clusters (e.g.,
changes in activation or differentiation state) based on the behavior of
genes in the affected pathways.</p>
</blockquote>
<blockquote>
<p>Identification of marker genes is usually based around the
retrospective detection of differential expression between clusters.
Genes that are more strongly DE are more likely to have caused separate
clustering of cells in the first place. Several different statistical
tests are available to quantify the differences in expression profiles,
and different approaches can be used to consolidate test results into a
single ranking of genes for each cluster. These choices parametrize the
theoretical differences between the various marker detection
strategies.</p>
</blockquote>
<div class="section level5">
<h5 id="used-statistical-tests">Used statistical tests<a class="anchor" aria-label="anchor" href="#used-statistical-tests"></a>
</h5>
<p>For each cell grouping and gene, three distinct, adjustable
statistical tests are computed through
<code><a href="https://rdrr.io/pkg/scran/man/findMarkers.html" class="external-link">scran::findMarkers()</a></code>:</p>
<ul>
<li>t-test (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseTTests.html" class="external-link">scran::pairwiseTTests()</a></code>): test for difference
in mean expression.</li>
<li>
<a href="https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test" class="external-link">Wilcoxon
signed-rank test</a> (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseWilcox.html" class="external-link">scran::pairwiseWilcox()</a></code>): test for
difference in median expression (roughly speaking).</li>
<li>Binomial test (<code><a href="https://rdrr.io/pkg/scran/man/pairwiseBinom.html" class="external-link">scran::pairwiseBinom()</a></code>): test the null
hypothesis that the proportion of cells expressing a gene is the same
between groups.</li>
</ul>
<p>These tests are performed in a <a href="https://bioconductor.org/books/3.15/OSCA.basic/marker-detection.html#scoring-markers-by-pairwise-comparisons" class="external-link">pairwise
fashion</a> within each grouping, i.e. each level of the grouping is
tested against each other.</p>
<p>Example: three pairwise tests of each type are computed for k-means
clustering with <span class="math inline">\(k = 3\)</span>:</p>
<ul>
<li>Cluster 1 vs. Cluster 2</li>
<li>Cluster 1 vs. Cluster 3</li>
<li>Cluster 2 vs. Cluster 3</li>
</ul>
<p>The overall p-values, false discovery rate (FDR) and effect sizes
(log2 fold change (LFC) for t- and binomial test, and Area Under Curve
for Wilcoxon test) are calculated for the cell grouping from its all
pairwise tests (<code><a href="https://rdrr.io/pkg/scran/man/combineMarkers.html" class="external-link">scran::combineMarkers()</a></code>).</p>
</div>
<div class="section level5">
<h5 id="narrowing-down-the-number-of-cluster-markers">Narrowing down the number of cluster markers<a class="anchor" aria-label="anchor" href="#narrowing-down-the-number-of-cluster-markers"></a>
</h5>
<p>A more or less stringent approach can be used to narrow down the
number of cluster markers, based on results from individual pairwise
tests. This will also affect the combined p-value and FDR:</p>
<ul>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#looking-for-any-differences" class="external-link">Looking
for any differences</a>: for each level (cluster) of a grouping, take
top markers by p-value from each pairwise test. This will be shown as
<code>Top</code> column in marker table. Example: the set of all genes
with <code>Top</code> values of 1 contains the gene with the lowest
p-value from each comparison.</li>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#finding-cluster-specific-markers" class="external-link">Finding
cluster-specific markers</a>: a more stringent approach only considering
genes that are differentially expressed in all pairwise comparisons
involving the cluster of interest. For this purpose is used an
intersection-union test where the combined p-value for each gene is the
maximum of the p-values from all pairwise comparisons. A gene will only
achieve a low combined p-value if it is strongly DE in all comparisons
to other clusters.</li>
<li>
<a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#balancing-stringency-and-generality" class="external-link">Balancing
stringency and generality</a>: the Holm-Bonferroni correction is applied
on pairwise p-values and the middle-most value is taken as the combined
p-value. This effectively tests the global null hypothesis that at least
50% of the individual pairwise comparisons exhibit no differential
expression.</li>
</ul>
<p>This can be controlled via the <code>PVAL_TYPE</code> parameter.</p>
</div>
<div class="section level5">
<h5 id="handling-blocking-factors">Handling blocking factors<a class="anchor" aria-label="anchor" href="#handling-blocking-factors"></a>
</h5>
<p><a href="https://bioconductor.org/books/3.12/OSCA/marker-detection.html#marker-batch" class="external-link">Blocking
factors</a> (e.g. batch effect, sex differences, cell cycle phases) can
be handled by further nesting. For that, each pairwise test is performed
separately in each level of the blocking factor. Then, p-values from
individual levels’ tests are combined, and the final combined p-values
are obtained by the method of choice (see above).</p>
<p>This can be controlled via the <code>BLOCK_COLUMN</code>
parameter.</p>
<hr>
</div>
</div>
</div>
<div class="tab-pane" id="config-parameters" role="tabpanel" aria-labelledby="config-parameters-tab">

<p>Cluster markers config is stored in the
<code>config/single_sample/cluster_markers.yaml</code> and
<code>config/integration/cluster_markers.yaml</code> files (the location
of this file is different for the single-sample and integration
pipelines). As for the <a href="config_pipeline.html">pipeline
config</a>, directory with this file is read from environment
variables:</p>
<ul>
<li>
<code>SCDRAKE_SINGLE_SAMPLE_CONFIG_DIR</code> for the single-sample
pipeline</li>
<li>
<code>SCDRAKE_INTEGRATION_CONFIG_DIR</code> for the integration
pipeline</li>
</ul>
<p>Options named in lowercase are set upon <a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a> load
or attach. Then the actual directory used depends on whether you run
<code><a href="../reference/run_pipeline.html">run_single_sample_r()</a></code> or
<code><a href="../reference/run_pipeline.html">run_integration_r()</a></code>.</p>
<hr>
<div class="section level4">
<h4 id="cluster-markers">Cluster markers<a class="anchor" aria-label="anchor" href="#cluster-markers"></a>
</h4>
<div class="sourceCode" id="cb1"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_SOURCES_DEFAULTS</span><span class="kw">:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">COMMON_PARAMS</span><span class="kw">:</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">PLOT_DIMREDS</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"umap"</span><span class="kw">]</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">BLOCK_COLUMN</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">PARAMS_T</span><span class="kw">:</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_DIRECTION</span><span class="kw">:</span><span class="at"> </span><span class="st">"up"</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_TEST</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">PVAL_TYPE</span><span class="kw">:</span><span class="at"> </span><span class="st">"any"</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MIN_PROP</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">STD_LFC</span><span class="kw">:</span><span class="at"> </span><span class="ch">False</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">PARAMS_WILCOX</span><span class="kw">:</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_DIRECTION</span><span class="kw">:</span><span class="at"> </span><span class="st">"up"</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_TEST</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">PVAL_TYPE</span><span class="kw">:</span><span class="at"> </span><span class="st">"any"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MIN_PROP</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">STD_LFC</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="fu">PARAMS_BINOM</span><span class="kw">:</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_DIRECTION</span><span class="kw">:</span><span class="at"> </span><span class="st">"up"</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">LFC_TEST</span><span class="kw">:</span><span class="at"> </span><span class="dv">0</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">PVAL_TYPE</span><span class="kw">:</span><span class="at"> </span><span class="st">"any"</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">MIN_PROP</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">STD_LFC</span><span class="kw">:</span><span class="at"> </span><span class="ch">null</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="dv">10</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_HEATMAP</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="dv">5</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">TOP_N_WT_PLOT</span><span class="kw">:</span><span class="at"> </span><span class="st">"top"</span></span></code></pre></div>
<p><strong>Type:</strong> named list (dictionary) of named lists</p>
<p>Default parameters for computation and reporting of cluster markers.
These can be overriden for each of the cluster markers source in
<code>CLUSTER_MARKERS_SOURCES</code> (see below).</p>
<ul>
<li>
<code>COMMON_PARAMS</code>: used for all statistical tests and their
results.
<ul>
<li>
<code>PLOT_DIMREDS</code> (character vector: <code>"pca"</code>,
<code>"tsne"</code>, <code>"umap"</code>): which dimensionality
reductions to use for marker plots.</li>
<li>
<code>BLOCK_COLUMN</code> (character scalar or <code>null</code>):
which column to use as the blocking factor. Examples: <code>phase</code>
(cell cycle phase), <code>batch</code> (sample of origin - integration
pipeline).</li>
</ul>
</li>
<li>
<code>PARAMS_T</code>, <code>PARAMS_WILCOX</code>,
<code>PARAMS_BINOM</code>: parameters for individual test types.
<ul>
<li>Computation parameters (passed to <code><a href="https://rdrr.io/pkg/scran/man/findMarkers.html" class="external-link">scran::findMarkers()</a></code>,
<code><a href="https://rdrr.io/pkg/scran/man/pairwiseTTests.html" class="external-link">scran::pairwiseTTests()</a></code>,
<code><a href="https://rdrr.io/pkg/scran/man/pairwiseWilcox.html" class="external-link">scran::pairwiseWilcox()</a></code>, or
<code><a href="https://rdrr.io/pkg/scran/man/pairwiseBinom.html" class="external-link">scran::pairwiseBinom()</a></code>):
<ul>
<li>
<code>LFC_DIRECTION</code> (character scalar: <code>"any"</code> |
<code>"up"</code> | <code>"down"</code>): the direction of log-fold
changes to be considered in the alternative hypothesis.</li>
<li>
<code>LFC_TEST</code> (positive numeric scalar): the log-fold change
threshold to be tested against.</li>
<li>
<code>PVAL_TYPE</code> (character scalar: <code>"any"</code> |
<code>"some"</code> | <code>"all"</code>): how p-values are to be
combined across pairwise comparisons for a given group/cluster. If
<code>"any"</code>, <code>top</code> column will be present in cluster
markers tables. By this parameter you can control the stringency of
marker detection.</li>
<li>
<code>MIN_PROP</code> (numeric scalar: <code>&lt;0; 1&gt;</code>, or
<code>null</code>): the minimum proportion of significant comparisons
per gene. Defaults to <code>0.5</code> when <code>PVAL_TYPE</code> is
<code>"some"</code>, otherwise defaults to zero.</li>
<li>
<code>STD_LFC</code> (logical scalar): whether log-fold changes
should be standardized by the variance. Only possible when t-test is
being used, and it is equivalent to Cohen’s <span class="math inline">\(d\)</span>. Standardized log-fold changes may be
more appealing for visualization as it avoids large fold changes due to
large variance. The choice of <code>STD_LFC</code> does not affect the
calculation of the p-values. Note: for compatibility reasons,
<code>STD_LFC</code> parameter is set, but not used in
<code>PARAMS_WILCOX</code> and <code>PARAMS_BINOM</code>.</li>
</ul>
</li>
<li>Reporting parameters:
<ul>
<li>
<code>TOP_N_HEATMAP</code> (positive integer scalar or
<code>.inf</code>): for how many top N markers to generate heatmaps. The
column used for determination of the top N markers is set by
<code>TOP_N_WT_HEATMAP</code>. You can also use all markers, either by
supplying a huge number, or by using <code>.inf</code>, which is
translated to R’s <code>Inf</code>.</li>
<li>
<code>TOP_N_WT_HEATMAP</code> (character scalar: <code>"top"</code>
| <code>"fdr"</code> | <code>"lfc"</code> | <code>"auc"</code>): which
column from a marker table to use for determination of the top N
markers.
<ul>
<li>
<code>"top"</code> can be only used when <code>PVAL_TYPE</code> is
<code>"some"</code>.</li>
<li>
<code>"auc"</code> can be only used inside
<code>PARAMS_WILCOX</code>.</li>
</ul>
</li>
<li>
<code>TOP_N_PLOT</code> (positive integer scalar): same as
<code>TOP_N_HEATMAP</code>, but used for marker plots.</li>
<li>
<code>TOP_N_WT_PLOT</code> (character scalar: <code>"top"</code> |
<code>"fdr"</code> | <code>"lfc"</code> | <code>"auc"</code>): same as
<code>TOP_N_WT_HEATMAP</code>, but used for marker plots.</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<div class="sourceCode" id="cb2"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_SOURCES</span><span class="kw">:</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">markers_cluster_graph_leiden_r0.4</span><span class="kw">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_graph_leiden_r0.4"</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Cluster markers for Leiden clustering (r = 0.4)"</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="at">    </span><span class="fu">markers_cluster_graph_leiden_r0.8</span><span class="kw">:</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_graph_leiden_r0.8"</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Cluster markers for Leiden clustering (r = 0.8)"</span></span></code></pre></div>
<p><strong>Type:</strong> list of named lists</p>
<p>This parameter is used to specify cell groupings (“sources”) in which
markers are searched for, and test and output parameters. You can use
any categorical column - results of cell clustering, <code>phase</code>
(cell cycle), etc., or custom groupings defined by
<code>CELL_GROUPINGS</code> in <code>02_norm_clustering.yaml</code> and
<code>02_int_clustering.yaml</code>. See <a href="#clustering">clustering targets</a> for a list of clustering
names.</p>
<p>Let’s examine the first entry
(<code>markers_cluster_graph_leiden_r0.4</code>):</p>
<ul>
<li>
<code>markers_cluster_graph_leiden_r0.4</code>: name of this
comparison. You can use whatever name you want.</li>
<li>
<code>source_column: "cluster_graph_leiden_r0.4"</code> (character
scalar): which cell grouping to use for computation of cell
markers.</li>
<li>
<code>description: "Cluster markers for Leiden clustering (r = 0.4)"</code>
(character scalar): description of this comparison, will appear in
reports and plots.</li>
</ul>
<p>In each entry you can override parameters in
<code>CLUSTER_MARKERS_SOURCES_DEFAULTS</code> (by using lowercase
names). For example, let’s consider the following scenario:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_SOURCES</span><span class="kw">:</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="at">  </span><span class="kw">-</span><span class="at"> </span><span class="fu">markers_cluster_graph_leiden_r0.4</span><span class="kw">:</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">source_column</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_graph_leiden_r0.4"</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">description</span><span class="kw">:</span><span class="at"> </span><span class="st">"Cluster markers for Leiden clustering (r = 0.4)"</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">common_params</span><span class="kw">:</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">plot_dimreds</span><span class="kw">:</span><span class="at"> </span><span class="kw">[</span><span class="st">"umap"</span><span class="kw">,</span><span class="at"> </span><span class="st">"pca"</span><span class="kw">]</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="at">      </span><span class="fu">params_t</span><span class="kw">:</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">pval_type</span><span class="kw">:</span><span class="at"> </span><span class="st">"some"</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">top_n_wt_heatmap</span><span class="kw">:</span><span class="at"> </span><span class="st">"fdr"</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="at">        </span><span class="fu">top_n_wt_plot</span><span class="kw">:</span><span class="at"> </span><span class="st">"fdr"</span></span></code></pre></div>
<p>Here, <code>train_params</code> and <code>common_params</code> will
override corresponding parameters in <code>PARAMS_T</code> and
<code>COMMON_PARAMS</code>, respectively, in
<code>CELL_ANNOTATION_SOURCES_DEFAULTS</code>.</p>
<blockquote>
<p>Watch out for the proper indentation. See the “Merging of nested
named lists” section in <code><a href="../articles/scdrake_config.html">vignette("scdrake_config")</a></code>.</p>
</blockquote>
<hr>
<div class="sourceCode" id="cb4"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">MAKE_CLUSTER_MARKERS_PLOTS</span><span class="kw">:</span><span class="at"> </span><span class="ch">True</span></span></code></pre></div>
<p><strong>Type:</strong> logical scalar</p>
<p>Set to <code>False</code> to skip making of marker plots. In that
case, for compatibility reasons, empty files will be created.</p>
<hr>
</div>
<div class="section level4">
<h4 id="input-files">Input files<a class="anchor" aria-label="anchor" href="#input-files"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_TABLE_TEMPLATE_RMD_FILE</span><span class="kw">:</span><span class="at"> </span><span class="st">"Rmd/common/cluster_markers_table_template.Rmd"</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_REPORT_RMD_FILE</span><span class="kw">:</span><span class="at"> </span><span class="st">"Rmd/common/cluster_markers.Rmd"</span></span></code></pre></div>
<p><strong>Type:</strong> character scalar</p>
<p>Paths to RMarkdown files used for HTML reports of this pipeline
stage.</p>
<hr>
</div>
<div class="section level4">
<h4 id="output-files">Output files<a class="anchor" aria-label="anchor" href="#output-files"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_BASE_OUT_DIR</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers"</span></span></code></pre></div>
<p><strong>Type:</strong> character scalar</p>
<p>A path to base output directory for this stage. It will be created
under <code>BASE_OUT_DIR</code> specified in <code>00_main.yaml</code>
config.</p>
<hr>
<div class="sourceCode" id="cb7"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_REPORT_HTML_FILE</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers.html"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_HEATMAPS_OUT_DIR</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers_heatmaps"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_PLOTS_BASE_OUT_DIR</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers_plots"</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_DIMRED_PLOTS_BASE_OUT_DIR</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers_dimred_plots"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="fu">CLUSTER_MARKERS_TABLES_OUT_DIR</span><span class="kw">:</span><span class="at"> </span><span class="st">"cluster_markers_tables"</span></span></code></pre></div>
<p><strong>Type:</strong> character scalar</p>
<p>Names of files and directories created under
<code>CLUSTER_MARKERS_BASE_OUT_DIR</code>. Subdirectories are not
allowed.</p>
</div>
</div>
<div class="tab-pane" id="outputs" role="tabpanel" aria-labelledby="outputs-tab">

<p>Here you can find description of the most important targets for this
stage. However, for a full overview, you have to inspect the <a href="https://github.com/bioinfocz/scdrake/blob/main/R/plans_common.R" class="external-link">source
code</a> of the <code><a href="../reference/get_subplan_common.html">get_cluster_markers_subplan()</a></code> function.</p>
<div class="section level4">
<h4 id="singlecellexperiment-objects">
<code>SingleCellExperiment</code> objects<a class="anchor" aria-label="anchor" href="#singlecellexperiment-objects"></a>
</h4>
<p><code>sce_dimred_cluster_markers</code>,
<code>sce_final_cluster_markers</code>: SCE objects with computed
dimensionality reductions. Used for generation of marker plots and
heatmaps</p>
<p><code>sce_cluster_markers</code>: Final SCE object with cell
clusterings from the <code>02_norm_clustering</code> (single-sample
pipeline) or <code>02_int_clustering</code> stage (integration
pipeline). Used to compute cluster markers. You can inspect the cell
groupings which can be used for marker computation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">drake</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/drake/reference/readd.html" class="external-link">loadd</a></span><span class="op">(</span><span class="va">sce_final_cluster_markers</span><span class="op">)</span></span>
<span><span class="fu">SingleCellExperiment</span><span class="fu">::</span><span class="fu">colData</span><span class="op">(</span><span class="va">sce_final_cluster_markers</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="tibbles-with-parameters">Tibbles with parameters<a class="anchor" aria-label="anchor" href="#tibbles-with-parameters"></a>
</h4>
<p>Usually, each row of these tibbles is passed to a function within the
<a href="https://docs.ropensci.org/drake" class="external-link">drake</a> plan.</p>
<p><code>cluster_markers_params</code>: all parameters for computation
of cluster markers</p>
<p>The following tibbles are derived from
<code>cluster_markers_params</code>:
<code>cluster_markers_test_params</code>,
<code>cluster_markers_heatmap_params</code>,
<code>cluster_markers_plot_params</code>,
<code>cluster_markers_dimred_plot_params</code></p>
</div>
<div class="section level4">
<h4 id="tibbles-with-cluster-markers-test-results">Tibbles with cluster markers test results<a class="anchor" aria-label="anchor" href="#tibbles-with-cluster-markers-test-results"></a>
</h4>
<p><code>cluster_markers_raw</code>: this tibble has the same columns as
<code>cluster_markers_test_params</code>, except the list column
(<code>&lt;DataFrame&gt;</code>) <code>markers</code> with test results
is added, and each level of <code>source_column</code> is expanded to a
separate row.</p>
<p>So for example, if a row has <code>group_level = 1</code>, its
<code>markers</code> <code>DataFrame</code> contains test results of
this level versus all other ones.</p>
<p>See <code><a href="https://rdrr.io/pkg/scran/man/combineMarkers.html" class="external-link">scran::combineMarkers()</a></code> for more details on the
output format, and <code><a href="../reference/scran_markers.html">scran_markers()</a></code> for a description of
changes made to the output of the former function.</p>
<hr>
<p><code>cluster_markers</code>: same as
<code>cluster_markers_raw</code>, but for Wilcox tests, combined LFC is
added to <code>DataFrame</code>s in <code>markers</code> column</p>
<hr>
<p><code>cluster_markers_processed</code>: same as
<code>cluster_markers</code>, but <code>markers</code>
<code>DataFrame</code>s don’t contain nested <code>DataFrame</code>s
(<code>lfc_*</code> or <code>auc_*</code>) - those are replaced by
combined effect sizes. This way you can inspect the effect sizes of
comparisons with all other levels.</p>
<p><code>cluster_markers_out</code>: holds the same data as
<code>cluster_markers_processed</code>, but <code>markers</code> are
coerced to dataframes and column names are normalized to snake_case</p>
<hr>
<p><code>cluster_markers_for_tables</code>: a summarized tibble glued
from <code>cluster_markers_out</code>,
<code>cluster_markers_heatmaps_df</code>, and
<code>cluster_markers_plots_top</code>. Marker tables in
<code>markers</code> column are in publish-ready forms for HTML output,
e.g. there are <code>&lt;a&gt;</code> links to ENSEMBL or PDF files of
marker plots.</p>
</div>
<div class="section level4">
<h4 id="heatmaps">Heatmaps<a class="anchor" aria-label="anchor" href="#heatmaps"></a>
</h4>
<p><code>seu_for_cluster_markers_heatmaps</code>: a <code>Seurat</code>
object used to generate heatmaps through <code><a href="../reference/marker_heatmap.html">marker_heatmap()</a></code>
(a wrapper around <code><a href="https://satijalab.org/seurat/reference/DoHeatmap.html" class="external-link">Seurat::DoHeatmap()</a></code>). In
<code>scale.data</code> slot of the <code>RNA</code> assay are UMI
counts transformed to z-score.</p>
<hr>
<p><code>cluster_markers_heatmaps_df</code>: a tibble derived from
<code>cluster_markers_heatmaps_df</code>, but enriched with cluster
markers test results</p>
<p>Two heatmaps for each row in <code>cluster_markers_heatmaps_df</code>
are made: one with log2 UMI counts, and second with the same values
transformed to z-score</p>
<p>For storage reasons, heatmap objects are not saved as R objects, but
only exported to PDF. However, you can obtain a tibble holding these
objects with</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">drake</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/drake/reference/readd.html" class="external-link">loadd</a></span><span class="op">(</span><span class="va">cluster_markers_heatmaps_df</span><span class="op">)</span></span>
<span><span class="va">heatmaps_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marker_heatmaps_wrapper.html">marker_heatmaps_wrapper</a></span><span class="op">(</span></span>
<span>  seu <span class="op">=</span> <span class="va">seu_for_cluster_markers_heatmaps</span>,</span>
<span>  params <span class="op">=</span> <span class="va">cluster_markers_heatmaps_df</span>,</span>
<span>  marker_type <span class="op">=</span> <span class="st">"global"</span>,</span>
<span>  save <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return_type <span class="op">=</span> <span class="st">"tibble"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In <code>heatmaps_tbl</code>, two list columns are appended to
<code>cluster_markers_heatmaps_df</code>:</p>
<ul>
<li>
<code>heatmaps</code>: a named list with heatmap object
(<code>p_heatmap</code>) and its z-score-transformed version
(<code>p_heatmap_zscore</code>).</li>
<li>
<code>markers_top</code>: a dataframe with top markers used in the
heatmaps (subsetted
<code>cluster_markers_processed$markers</code>).</li>
</ul>
<p>For more control you can use the <code><a href="../reference/marker_heatmap.html">marker_heatmap()</a></code>
function (of which is <code><a href="../reference/marker_heatmaps_wrapper.html">marker_heatmaps_wrapper()</a></code> a
wrapper).</p>
</div>
<div class="section level4">
<h4 id="marker-plots">Marker plots<a class="anchor" aria-label="anchor" href="#marker-plots"></a>
</h4>
<p><code>cluster_markers_plots_top</code>: a tibble with markers for
which plots will be made. See <code><a href="../reference/markers_plots_top.html">?markers_plots_top</a></code> for
details.</p>
<p>As for heatmaps, plot objects (<a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a>,
<a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a>) are not saved, but the underlying function can
be used:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/markers_plots_files.html">markers_plots_files</a></span><span class="op">(</span><span class="va">sce_dimred_cluster_markers</span>, <span class="va">cluster_markers_plots_top</span>, save <span class="op">=</span> <span class="cn">FALSE</span>, return_type <span class="op">=</span> <span class="st">"tibble"</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, the actual plotting function can be used, see
<code><a href="../reference/marker_plot.html">?marker_plot</a></code></p>
</div>
<div class="section level4">
<h4 id="dimensionality-reduction-plots">Dimensionality reduction plots<a class="anchor" aria-label="anchor" href="#dimensionality-reduction-plots"></a>
</h4>
<p><code>cluster_markers_dimred_plots</code>: a tibble with
dimensionality reduction plots for each of <code>source_column</code> in
the <code>CLUSTER_MARKERS_SOURCES</code> parameter and
<code>PLOT_DIMREDS</code> in <code>COMMON_PARAMS</code></p>
</div>
<div class="section level4">
<h4 id="other-targets">Other targets<a class="anchor" aria-label="anchor" href="#other-targets"></a>
</h4>
<p><code>config_cluster_markers</code>: a list holding parameters for
this stage</p>
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="copyright">
  <p></p>
<p>Developed by Jiri Novotny, Jan Kubovciak, Michal Kolar.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

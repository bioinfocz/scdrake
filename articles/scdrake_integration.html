<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>02 Integration pipeline guide • scdrake</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="02 Integration pipeline guide">
<meta property="og:description" content="scdrake">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=281550496"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '281550496');
</script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">scdrake</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/scdrake.html">Get started</a>
</li>
<li>
  <a href="../articles/scdrake_integration.html">Integration pipeline guide</a>
</li>
<li>
  <a href="../articles/pipeline_overview.html">Pipeline overview</a>
</li>
<li>
  <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="divider">
    </li>
<li class="dropdown-header">Guides</li>
    <li>
      <a href="../articles/scdrake_integration.html">02 Integration pipeline guide</a>
    </li>
    <li>
      <a href="../articles/scdrake_extend.html">Extending the pipeline</a>
    </li>
    <li>
      <a href="../articles/drake_basics.html">drake basics</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General information</li>
    <li>
      <a href="../articles/pipeline_overview.html">Pipeline overview</a>
    </li>
    <li>
      <a href="../articles/scdrake_faq.html">FAQ &amp; Howtos</a>
    </li>
    <li>
      <a href="../articles/cluster_markers.html">Cluster markers</a>
    </li>
    <li>
      <a href="../articles/scdrake_config.html">scdrake config internals</a>
    </li>
    <li>
      <a href="../articles/scdrake_envvars.html">Environment variables</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">General configs</li>
    <li>
      <a href="../articles/config_pipeline.html">Pipeline config</a>
    </li>
    <li>
      <a href="../articles/config_main.html">Main config</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Single-sample pipeline stages</li>
    <li>
      <a href="../articles/stage_input_qc.html">Input and quality control stage</a>
    </li>
    <li>
      <a href="../articles/stage_norm_clustering.html">Normalization and clustering stage</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Integration pipeline stages</li>
    <li>
      <a href="../articles/stage_integration.html">Integration stage</a>
    </li>
    <li>
      <a href="../articles/stage_int_clustering.html">Post-integration clustering stage</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Common stages</li>
    <li>
      <a href="../articles/stage_cluster_markers.html">Cluster markers stage</a>
    </li>
    <li>
      <a href="../articles/stage_contrasts.html">Contrasts stage</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/bioinfocz/scdrake" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>02 Integration pipeline guide</h1>
                        <h4 data-toc-skip class="author">Jiri
Novotny</h4>
            <address class="author_afil">
      Institute of Molecular Genetics of the Czech Academy of
Sciences<br><a class="author_email" href="mailto:#"></a><a href="mailto:jiri.novotny@img.cas.cz" class="email">jiri.novotny@img.cas.cz</a>
      </address>
                              <h4 data-toc-skip class="author">Jan
Kubovciak</h4>
            <address class="author_afil">
      Institute of Molecular Genetics of the Czech Academy of
Sciences<br><a class="author_email" href="mailto:#"></a><a href="mailto:jan.kubovciak@img.cas.cz" class="email">jan.kubovciak@img.cas.cz</a>
      </address>
                  
            <h4 data-toc-skip class="date">2022-09-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/bioinfocz/scdrake/blob/mastervignettes/scdrake_integration.Rmd" class="external-link"><code>vignettes/scdrake_integration.Rmd</code></a></small>
      <div class="hidden name"><code>scdrake_integration.Rmd</code></div>

    </div>

    
    
<hr>
<p>In this guide you will see how to integrate two datasets. The
<em>prerequisity</em> here is:</p>
<ul>
<li>A project initialized within the quick start guide
(<code><a href="../articles/scdrake.html">vignette("scdrake")</a></code>) that should live in the
<code>~/scdrake_single_sample_example</code> directory.</li>
<li>You have successfully run the pipeline as described in the third
step of the guide.</li>
</ul>
<hr>
<div class="section level2">
<h2 id="perform-normalization-and-clustering-for-the-pbmc-1k-sample">Perform normalization and clustering for the PBMC 1k sample<a class="anchor" aria-label="anchor" href="#perform-normalization-and-clustering-for-the-pbmc-1k-sample"></a>
</h2>
<p>The integration pipeline starts with import of
<code>SingleCellExperiment</code> (SCE) objects from <code>drake</code>
caches of underlying single-sample analyses. These objects are the final
ones from the <code>02_norm_clustering</code> stage, that is,
normalized, with known highly variable genes and clusters, and with
computed reduced dimensions. During the quick start guide, we only run
the first <code>01_input_qc</code> stage to save time, and therefore, we
need to run the single-sample pipeline again, but now till the target
storing the SCE object needed for the integration pipeline.</p>
<p>To do so, you just need:</p>
<ul>
<li>To open the RStudio project in
<code>~/scdrake_single_sample_example</code> (or change your current
working directory there).</li>
<li>To edit the <code>config/pipeline.yaml</code> file and set
<code>DRAKE_TARGETS</code> to
<code>["sce_final_norm_clustering"]</code>.</li>
</ul>
<blockquote>
<p>If you want to significantly save computation time for the sake of
quick guide, you can omit the calculation of very demanding SC3
clustering (will be replaced by random cluster assignments). To do so,
open <code>config/single_sample/02_norm_clustering.yaml</code> and set
<code>SC3_DRY</code> to <code>True</code>.</p>
</blockquote>
<blockquote>
<p>If you are interested in the full stage report, you can use
<code>["report_norm_clustering", "report_norm_clustering_simple"]</code>
instead (these targets depend on the
<code>sce_final_norm_clustering</code> target so it will be also
made).</p>
</blockquote>
<p>And now you can run the pipeline:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bioinfocz/scdrake" class="external-link">scdrake</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/run_pipeline.html">run_single_sample_r</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="prepare-the-second-sample---pbmc-3k">Prepare the second sample - PBMC 3k<a class="anchor" aria-label="anchor" href="#prepare-the-second-sample---pbmc-3k"></a>
</h2>
<p>As a second sample for the integration pipeline we will use another
dataset from 10X Genomics - PBMC 3k. To stick to the project-based
approach, we will initialize a new <code>scdrake</code> project:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_project.html">init_project</a></span><span class="op">(</span><span class="st">"~/scdrake_pbmc3k"</span><span class="op">)</span></span></code></pre></div>
<p>If not done automatically, change your RStudio project or switch the
current working directory to the project’s root.</p>
<p>Now we will repeat the steps we have already done for the PBMC 1k
sample:</p>
<ul>
<li>Open <code>config/single_sample/01_input_qc.yaml</code> and set
<code>path</code> inside <code>INPUT_DATA</code> to
<code>"~/scdrake_single_sample_example/example_data/pbmc3k"</code> (the
example data for PBMC 3k has been already downloaded when you had
initialized the project for PBMC 1k dataset).</li>
<li>Open <code>config/pipeline.yaml</code> and set
<code>DRAKE_TARGETS</code> to
<code>["sce_final_norm_clustering"]</code>.</li>
<li>Optionally to save time, open
<code>config/single_sample/02_norm_clustering.yaml</code> and set
<code>SC3_DRY</code> to <code>True</code>.</li>
</ul>
<p>The config modifications for the second sample are ready, so let’s
run the pipeline:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_pipeline.html">run_single_sample_r</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level2">
<h2 id="running-the-integration-pipeline">Running the integration pipeline<a class="anchor" aria-label="anchor" href="#running-the-integration-pipeline"></a>
</h2>
<p>First, as before for the individual samples, we will also initialize
a new <code>scdrake</code> project for integration analysis:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/init_project.html">init_project</a></span><span class="op">(</span><span class="st">"~/scdrake_integration"</span><span class="op">)</span></span></code></pre></div>
<p>Assuming your project is opened / working directory is set to the
project root, we modify configs for the integration pipeline:</p>
<ul>
<li>
<code>config/integration/01_integration.yaml</code>: set
<code>cache_path</code> to
<code>~/scdrake_single_sample_example/.drake</code> and
<code>~/scdrake_pbmc3k/.drake</code> for <code>pbmc1k</code> and
<code>pbmc3k</code> entries, respectively.</li>
<li>
<code>config/pipeline.yaml</code>: set <code>DRAKE_TARGETS</code> to
<code>["report_integration"]</code>. To save time, we only run the final
target of the <code>01_integration</code> stage.</li>
</ul>
<p>And now we can run the integration pipeline:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_pipeline.html">run_integration_r</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The output is saved in <code>output/integration</code>, as specified
by <code>BASE_OUT_DIR</code> in
<code>config/integration/00_main.yaml</code>. For
<code>01_integration</code> stage, you can find its final report in
<code>output/integration/01_integration/01_integration.html</code>.</p>
<p>You can try to load the target <code>sce_int_dimred_df</code> (a
tibble object) containing integrated <code>SingleCellExperiment</code>
objects with computed reduced dimensions:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">drake</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/drake/reference/readd.html" class="external-link">loadd</a></span><span class="op">(</span><span class="va">sce_int_dimred_df</span><span class="op">)</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jiri Novotny, Jan Kubovciak.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.9000.</p>
  <p class="preferably">Using <a href="https://preferably.amirmasoudabdol.name/?source=footer" class="external-link">preferably</a> template.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '937cedcd467c204b19fc155c5f35019b',
    indexName: 'scdrake',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
